{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>Match Management</h1>
    <p class="description">View and manage recorded matches. Deleting a match will restore ELO points to both players.</p>
    
    <div class="admin-nav">
        <a href="{{ url_for('main.admin') }}" class="nav-button">üë§ User Management</a>
        <a href="{{ url_for('main.admin_logs') }}" class="nav-button">üìã View Logs</a>
    </div>

    <table class="admin-table">
        <tr>
            <th>Date</th>
            <th>Winner</th>
            <th>Winner ELO Gain</th>
            <th>Loser</th>
            <th>Loser ELO Loss</th>
            <th>Winner 180s</th>
            <th>Loser 180s</th>
            <th>Finishes (W / L)</th>
            <th>Recorded By</th>
            <th>Actions</th>
        </tr>
        {% for match in matches.items %}
        <tr class="match-row">
            <td>{{ match.date_played.strftime('%Y-%m-%d %H:%M') }}</td>
            <td class="player-name">{{ match.winner.username }}</td>
            <td class="elo-gain positive">+{{ match.winner_elo_gain }}</td>
            <td class="player-name">{{ match.loser.username }}</td>
            <td class="elo-loss negative">{{ match.loser_elo_loss }}</td>
            <td class="stat-cell">{{ match.winner_180s }}</td>
            <td class="stat-cell">{{ match.loser_180s }}</td>
            <td class="stat-cell">
                {% if match.winner_finishes %}
                    {% set wfin = match.winner_finishes.split(',') %}
                    <strong>{{ wfin|join(', ') }}</strong>
                {% elif match.winning_finish > 0 %}
                    <strong>{{ match.winning_finish }}</strong>
                {% else %}-{% endif %}
                /
                {% if match.loser_finishes %}
                    {% set lfin = match.loser_finishes.split(',') %}
                    {{ lfin|join(', ') }}
                {% else %}-{% endif %}
            </td>
            <td class="recorder">{{ match.recorder.username if match.recorder else 'N/A' }}</td>
            <td class="actions">
                <form method="POST" action="{{ url_for('main.admin_delete_match', match_id=match.id) }}" class="inline-form" onsubmit="return confirm('Are you sure you want to delete this match? This will restore ELO points to both players.');">
                    <button type="submit" class="action-btn delete-match" title="Delete Match">üóëÔ∏è Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>

    {% if matches.items %}
    <div class="pagination">
        {% if matches.has_prev %}
        <a href="{{ url_for('main.admin_matches', page=matches.prev_num) }}" class="pagination-link">‚Üê Previous</a>
        {% endif %}
        <span class="pagination-info">Page {{ matches.page }} of {{ matches.pages }} ({{ matches.total }} matches)</span>
        {% if matches.has_next %}
        <a href="{{ url_for('main.admin_matches', page=matches.next_num) }}" class="pagination-link">Next ‚Üí</a>
        {% endif %}
    </div>
    {% else %}
    <div class="no-matches">
        <p>No matches recorded yet.</p>
    </div>
    {% endif %}
</div>

<style>
.description {
    text-align: center;
    color: #666;
    margin-bottom: 2em;
    font-size: 0.95em;
    background: #f9f9f9;
    padding: 1em;
    border-radius: 4px;
    border-left: 4px solid #ffb400;
}

.admin-nav {
    margin: 1em 0 2em;
    display: flex;
    gap: 1em;
    justify-content: flex-start;
}

.nav-button {
    display: inline-block;
    padding: 0.75em 1.5em;
    background: #222e50;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-weight: 500;
    transition: all 0.2s;
    border: 1px solid #222e50;
}
.admin-actions {
    margin: 1em 0 2em;
    display: flex;
    justify-content: flex-start;
}

.back-button {
    display: inline-block;
    padding: 0.5em 1em;
    background: #f0f0f0;
    color: #333;
    text-decoration: none;
    border-radius: 4px;
    border: 1px solid #ddd;
    transition: all 0.2s;
}

.back-button:hover {
    background: #e0e0e0;
    border-color: #ccc;
}

.admin-table {
    width: 100%;
    margin-top: 1em;
    font-size: 0.9em;
}

.match-row:hover {
    background: #f9f9f9;
}

.player-name {
    font-weight: 500;
    color: #222e50;
}

.elo-gain {
    font-weight: 600;
    color: #2d5a2d;
}

.elo-loss {
    font-weight: 600;
    color: #5a2d2d;
}

.positive {
    background: #e0f4e0;
}

.negative {
    background: #f4e0e0;
}

.stat-cell {
    text-align: center;
    font-weight: 500;
}

.recorder {
    font-style: italic;
    color: #666;
}

.actions {
    text-align: center;
}

.inline-form {
    display: inline;
}

.action-btn {
    padding: 0.3em 0.6em;
    border: none;
    border-radius: 3px;
    font-size: 0.8em;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
}

.delete-match {
    background: #f4e0e0;
    color: #5a2d2d;
    border: 1px solid #ddd;
}

.delete-match:hover {
    background: #f0d0d0;
    border-color: #5a2d2d;
    transform: translateY(-1px);
}

.pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 2em 0;
    padding: 1em;
    background: #f9f9f9;
    border-radius: 4px;
}

.pagination-link {
    padding: 0.5em 1em;
    background: #222e50;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    transition: all 0.2s;
}

.pagination-link:hover {
    background: #2d3b63;
    transform: translateY(-1px);
}

.pagination-info {
    font-weight: 500;
    color: #666;
}

.no-matches {
    text-align: center;
    padding: 3em;
    color: #666;
    background: #f9f9f9;
    border-radius: 4px;
    margin: 2em 0;
}
</style>
{% endblock %}

{% extends "base.html" %}

{% block content %}
    <div class="filters">
        <form method="GET" action="{{ url_for('main.matches') }}">
            <label for="player"><i class="fas fa-filter"></i> Filter by Player:</label>
            <select name="player" id="player">
                <option value="">All Players</option>
                {% for user in users %}
                <option value="{{ user.id }}" {% if request.args.get('player')|int == user.id %}selected{% endif %}>
                    {{ user.username }}
                </option>
                {% endfor %}
            </select>
            <button type="submit"><i class="fas fa-search"></i> Filter</button>
        </form>
    </div>

    <table>
        <thead>
        <tr>
            <th><i class="far fa-calendar"></i> Date</th>
            <th><i class="fas fa-crown"></i> Winner</th>
            <th><i class="fas fa-chart-line"></i> Winner's Old ELO</th>
            <th><i class="fas fa-arrow-up"></i> Winner ELO Gain</th>
            <th><i class="fas fa-times-circle"></i> Loser</th>
            <th><i class="fas fa-chart-line"></i> Loser's Old ELO</th>
            <th><i class="fas fa-arrow-down"></i> Loser ELO Loss</th>
            <th><i class="fas fa-user-check"></i> Recorded By</th>
        </tr>
        </thead>
        <tbody>
        {% for match in matches %}
        <tr>
            <td>{{ match.date_played.strftime('%Y-%m-%d %H:%M') }}</td>
            <td><strong style="color: var(--success-color);">{{ match.winner.username }}</strong></td>
            <td>{{ match.winner.elo - match.winner_elo_gain }}</td>
            <td class="positive">{{ match.winner_elo_gain }}</td>
            <td style="color: var(--text-secondary);">{{ match.loser.username }}</td>
            <td>{{ match.loser.elo - match.loser_elo_loss }}</td>
            <td class="negative">{{ match.loser_elo_loss }}</td>
            <td style="font-style: italic; color: var(--text-secondary);">{{ match.recorder.username if match.recorder else 'N/A' }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    {% if matches.items %}
    <div class="pagination">
        {% if matches.has_prev %}
        <a href="{{ url_for('main.matches', page=matches.prev_num, player=request.args.get('player', '')) }}">
            <i class="fas fa-chevron-left"></i> Previous
        </a>
        {% endif %}
        <span><i class="fas fa-file-alt"></i> Page {{ matches.page }} of {{ matches.pages }}</span>
        {% if matches.has_next %}
        <a href="{{ url_for('main.matches', page=matches.next_num, player=request.args.get('player', '')) }}">
            Next <i class="fas fa-chevron-right"></i>
        </a>
        {% endif %}
    </div>
    {% endif %}
{% endblock %}

{% extends "base.html" %}

{% block content %}
<div class="container">
    <img src="{{ url_for('static', filename='banner-match-history.png') }}" alt="Match History" class="logo">    
    
    <div class="filters">
        <form method="GET" action="{{ url_for('main.matches') }}">
            <label for="player">Filter by Player:</label>
            <select name="player" id="player">
                <option value="">All Players</option>
                {% for user in users %}
                <option value="{{ user.id }}" {% if request.args.get('player')|int == user.id %}selected{% endif %}>
                    {{ user.username }}
                </option>
                {% endfor %}
            </select>
            <button type="submit">Filter</button>
        </form>
    </div>

    <table>
        <tr>
            <th>Date</th>
            <th>Winner</th>
            <th>Winner's Old ELO</th>
            <th>Winner ELO Gain</th>
            <th>Loser</th>
            <th>Loser's Old ELO</th>
            <th>Loser ELO Loss</th>
            <th>Recorded By</th>
        </tr>
        {% for match in matches %}
        <tr>
            <td>{{ match.date_played.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ match.winner.username }}</td>
            <td>{{ match.winner.elo - match.winner_elo_gain }}</td>
            <td class="positive">+{{ match.winner_elo_gain }}</td>
            <td>{{ match.loser.username }}</td>
            <td>{{ match.loser.elo - match.loser_elo_loss }}</td>
            <td class="negative">{{ match.loser_elo_loss }}</td>
            <td>{{ match.recorder.username if match.recorder else 'N/A' }}</td>
        </tr>
        {% endfor %}
    </table>

    {% if matches.items %}
    <div class="pagination">
        {% if matches.has_prev %}
        <a href="{{ url_for('main.matches', page=matches.prev_num, player=request.args.get('player', '')) }}">Previous</a>
        {% endif %}
        <span>Page {{ matches.page }} of {{ matches.pages }}</span>
        {% if matches.has_next %}
        <a href="{{ url_for('main.matches', page=matches.next_num, player=request.args.get('player', '')) }}">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
